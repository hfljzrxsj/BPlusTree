import{j as r}from"./react-ejZHSj7z.js";import{S as ge,A as ve,P as L,T as oe,B as D,D as Pe,a as je,b as Se,c as be,d as Ce,C as Re}from"./@mui-hLjQcYBy.js";import{u as O,a as ke}from"./ahooks-fqGfSRxQ.js";import"./object-assign-4_VUvG2Z.js";import"./@emotion-A8WsZfug.js";import"./hoist-non-react-statics-o0ngdJFr.js";import"./@babel-pdUxmcoj.js";import"./stylis-UTZzoVRx.js";import"./clsx-2Jv0kmJG.js";import"./tslib-safrqDFn.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function s(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=s(n);fetch(n.href,a)}})();var j=(e=>(e.SnackbarAlert="SnackbarAlert",e.OPENTRUE="OPENTRUE",e.OPENFALSE="OPENFALSE",e))(j||{}),d=(e=>(e.alertText="alertText",e.open="open",e.severity="severity",e))(d||{});const Ee={alertText:"",open:!1,severity:"success"},Te=(e=Ee,t)=>{const{type:s,payload:o={}}=t,n=a=>({...e,...o,open:a});switch(s){case"OPENFALSE":return n(!1);case"OPENTRUE":return n(!0);default:return e}},Fe=ReactRedux.useSelector,Le=Redux.combineReducers({SnackBar:Te}),he=Redux.legacy_createStore(Le,Redux.applyMiddleware(ReduxThunk));he.subscribe(()=>{});const De="_Snackbar_1t4e7_1",Oe={Snackbar:De};function Ue(){const{open:e,alertText:t,severity:s}=Fe(a=>({open:a.SnackBar.open,alertText:a.SnackBar.alertText,severity:a.SnackBar.severity})),o=ReactRedux.useDispatch(),n=(a,l)=>{l!=="clickaway"&&o({type:j.OPENFALSE})};return r.jsx(React.StrictMode,{children:r.jsx(ge,{open:!!(e&&t),autoHideDuration:6e3,onClose:n,message:t,className:Oe.Snackbar??"",children:r.jsx(ve,{onClose:n,severity:s,variant:"filled",children:t})})})}const Ae="_Paper_2whqo_1",Be="_CRUD_2whqo_12",le={Paper:Ae,CRUD:Be},{pow:z}=Math;function _e(e){const t=[];let o=e;for(let n=2;n>=0;n--){const a=Math.pow(256,n),l=Math.floor(o/a);t.push(l),o-=l*a}return o!==0&&t.push(o),t}const te=16*1024,p=64,S=te/p,me=10,ue=async()=>{const e=await window.showDirectoryPicker(),t={mode:"readwrite",writable:!0};for(;await e.queryPermission(t)!=="granted";)await e.requestPermission(t);return e},R=3,We=4,ze=e=>e?`${e}_`:"",U=e=>e.toString().split("").map(t=>t.charCodeAt(0)),ee=async(e,t=S,...s)=>{const o=s.join("_"),n=ze(o),a=await e.getFileHandle(`${o}.txt`,{create:!0}),l=s.reduce((y,h,b)=>y+h*z(S,R-b-1),0),w=await a.createWritable(),x=new Uint8Array(te);for(let y=0;y<S;++y){const h=new Uint8Array(p);if(y<t){const b=z(S,R-s.length-1)*(y+1)+l,N=U(b),k=U(`${n}${y}`);h.set(N,0),h.set(k,N.length+1)}h[p-1]=me,x.set(h,y*p)}await w.write(x),await w.close()},de=async(e,t=0)=>{let s="";for(;t<p;++t){const o=e[t];if(!o)break;s+=String.fromCharCode(o)}return s},Me=async(e,t)=>{const s=t*p;try{return new Uint8ClampedArray(e.slice(s,s+p))}catch{return new Uint8ClampedArray(p)}},$e=(e,t,s)=>e<=t&&e>t-z(S,R-s-1),He=async(e,t,s,o)=>{const n=await Me(e,s),a=await de(n);if(!a)return{empty:!0};const l=parseInt(a);return $e(o,l,t)?{value:await de(n,a.length+1)}:{}};var we=(e=>(e[e.read=0]="read",e[e.create=1]="create",e[e.delete=2]="delete",e))(we||{});const Ie=(e,t,s,o,n,a,l)=>w=>new Promise(async x=>{if(n===R-1)switch(e){case 1:return w({type:j.OPENTRUE,payload:{[d.alertText]:"create fail",[d.severity]:"error"}}),x(!0),!0;case 2:{const y=await t(),h=await y.getFile(),b=await y.createWritable();let N=new Uint8ClampedArray(await h.arrayBuffer());N.set(new Uint8ClampedArray(p-1),o*p),await b.write(N),await b.close();let k=h.name;for(let E=a.length-1;E>=0;--E){const A=l[E];if(N.every(C=>C===0||C===10)&&!Number.isNaN(A)&&A!==void 0){await s.removeEntry(k);const C=a[E];if(!C)continue;const M=await C(),B=await M.getFile();k=B.name;const _=await B.arrayBuffer(),i=await M.createWritable();N=new Uint8ClampedArray(_),N.set(new Uint8ClampedArray(p-1),A*p),await i.write(N),await i.close()}}return w({type:j.OPENTRUE,payload:{[d.alertText]:"delete success",[d.severity]:"success"}}),x(!0),!0}}return x(!1),!1}),fe=async(e,t,s,o,n)=>{let a=NaN;for(let l=0;l<S;++l){const w=await He(e,t,l,s);o===1&&w.empty&&Number.isNaN(n)&&Number.isNaN(a)&&(a=l);const x=w.value;if(x)return{value:x,tempEmptyLine:a,k:l}}return{tempEmptyLine:a}},pe=(e,t)=>Number.isNaN(e)&&!Number.isNaN(t),ye="";function Ke(){const e=ReactRedux.useDispatch(),[t,s,o]=O(),[n,a,l]=O(),[w,x,y]=O([]),h=ke(async()=>{s(await ue())}),[,b,N]=O(ye),[k,E,A]=O(""),[C,M]=O(ye),B=React.useCallback(async()=>{let i=o();return i||(i=await ue(),s(i)),i},[t]),_=(i=0)=>ReactDOM.unstable_batchedUpdates(async()=>{let c=NaN;const f=l()??[],W=N(),$=parseInt(W),xe=_e($-1),Q={searchKey:W,thisLogs:[],mode:we[i]},H=await B();let g="",I=[],K=[];e:for(let m=0;m<R;m++){const re=(v,u,P,T)=>Ie(i,v,H,T??NaN,m,u,P??[])(e);for(let v=0;v<f.length;++v){const u=f[v];if(u&&u?.index===m&&g===u.fileName){const{file:P}=u,T=await(async()=>{try{return await P.arrayBuffer()}catch{try{const J=await(await H.getFileHandle(P.name)).getFile();return u.file=J,await J.arrayBuffer()}catch{return null}}})();if(!T)break;const F=await fe(T,m,$,i,c),Z=F.value,V=F.tempEmptyLine,ce=F.k;if(Z){pe(c,V)&&(c=V);const G=(J=>async()=>await H.getFileHandle(`${J}.txt`))(g);if(await re(G,I,K,ce))return;I.push(G),K.push(ce??NaN),g=Z,u.timestamp=Date.now(),Q.thisLogs.push({method:"内存",fileName:u.fileName});continue e}}}const X=await H.getFileHandle(`${g}.txt`,{create:!0}),q=await X.getFile(),ae=await q.arrayBuffer(),Y=await fe(ae,m,$,i,c),ne=Y.value,ie=Y.tempEmptyLine,se=Y.k;if(pe(c,ie)&&(c=ie),ne){const v=async()=>X;if(await re(v,I,K,se))return;f.length>=We&&f.pop(),f.push({fileName:g,timestamp:Date.now(),file:q,index:m}),Q.thisLogs.push({method:"磁盘",fileName:g}),g=ne,I.push(v),K.push(se??NaN),f.sort((u,P)=>u.index===P.index?P.timestamp-u.timestamp:u.index-P.index);continue e}switch(Number.isNaN(c)?c=q.size:c*=p,i){case 1:{if(!C||!W){e({type:j.OPENTRUE,payload:{[d.alertText]:"input require",[d.severity]:"warning"}});return}const v=await X.createWritable(),u=await(async()=>q.size?new Uint8ClampedArray(ae):new Uint8ClampedArray(te))();if(m===R-1)u.set(U(W),c),u.set(U(C),c+W.length+1),u[c+p-1]=me;else{const P=z(S,R-m-1),T=~~(($-1)/P),F=U((T+1)*P);g=xe.filter((Z,V)=>V<=m).join("_"),u.set(F,c),u.set(U(g),c+F.length+1)}await v.write(u),await v.close(),e({type:j.OPENTRUE,payload:{[d.alertText]:"create success",[d.severity]:"success"}});break}case 0:{e({type:j.OPENTRUE,payload:{[d.alertText]:"read fail",[d.severity]:"error"}});return}case 2:{e({type:j.OPENTRUE,payload:{[d.alertText]:"delete fail",[d.severity]:"error"}});return}}c=NaN}g&&(x(m=>[...m,Q]),a(f)),E(g),e({type:j.OPENTRUE,payload:{[d.alertText]:"read success",[d.severity]:"success"}})});return r.jsxs(r.Fragment,{children:[r.jsxs(L,{elevation:24,className:le.Paper??"",children:[r.jsx(L,{elevation:24,children:(l()??n)?.map(i=>r.jsxs(L,{elevation:24,children:[r.jsx("h4",{children:i.index}),r.jsxs("p",{children:[i.fileName,".txt"]})]},i.timestamp+i.fileName+i.index))},0),r.jsxs(L,{elevation:24,className:le.CRUD??"",children:[r.jsx(oe,{label:"key",onChange:i=>b(i.target.value),autoFocus:!0,fullWidth:!0,required:!0,type:"number",inputProps:{min:0,max:z(S,R)}}),r.jsx(oe,{label:"value",onChange:i=>M(i.target.value),fullWidth:!0}),r.jsx(D,{size:"large",variant:"contained",fullWidth:!0,onClick:async()=>{let i=await B();for await(const c of i.values())await i.removeEntry(c.name);await ee(i,2);for(let c=0;c<=1;++c)await ee(i,2,c);for(let c=0;c<=1;++c)for(let f=0;f<=1;++f)await ee(i,S,c,f);e({type:j.OPENTRUE,payload:{[d.alertText]:"init success",[d.severity]:"success"}})},children:"init"}),r.jsx(D,{size:"large",variant:"contained",fullWidth:!0,onClick:_.bind(null,1),children:"Create"}),r.jsx(D,{size:"large",variant:"contained",fullWidth:!0,onClick:_.bind(null,0),children:"Read"}),r.jsx(D,{size:"large",variant:"contained",disabled:!0,fullWidth:!0,children:"Update"}),r.jsx(D,{size:"large",variant:"contained",fullWidth:!0,onClick:_.bind(null,2),children:"Delete"}),r.jsx("p",{children:A()??k})]},1),r.jsx(L,{elevation:24,children:(y()??w).map((i,c)=>r.jsxs(L,{elevation:24,children:[r.jsx("h5",{children:i.searchKey}),r.jsx("h6",{children:i.mode}),r.jsx("ul",{children:i.thisLogs.map(f=>r.jsx("li",{children:`${f.fileName}.txt (${f.method})`},f.fileName))})]},c))},2)]}),r.jsxs(Pe,{open:!t,onAuxClick:h,onClick:h,onKeyDown:h,children:[r.jsx(je,{children:"请选择文件夹"}),r.jsx(Se,{children:r.jsx(D,{size:"large",variant:"contained",fullWidth:!0,autoFocus:!0,children:"确定"})})]})]})}React.createContext(!1);const qe=()=>r.jsx(React.StrictMode,{children:r.jsx(be,{injectFirst:!0,children:r.jsxs(Ce,{children:[r.jsx(Re,{}),r.jsxs(ReactRedux.Provider,{store:he,children:[r.jsx(Ke,{}),r.jsx(Ue,{})]})]})})});ReactDOM.render(r.jsx(React.StrictMode,{children:r.jsx(qe,{})}),document.body);
